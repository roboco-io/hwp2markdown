#!/bin/bash
# pre-push hook: lintì™€ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  ëª¨ë‘ í†µê³¼í•´ì•¼ push í—ˆìš©

set -e

echo "ğŸ” Running pre-push checks..."
echo ""

# ìƒ‰ìƒ ì •ì˜
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# ì‹¤íŒ¨ ì‹œ ë©”ì‹œì§€ ì¶œë ¥ í•¨ìˆ˜
fail() {
    echo ""
    echo -e "${RED}âŒ Pre-push check failed: $1${NC}"
    echo -e "${YELLOW}Push aborted. Please fix the issues and try again.${NC}"
    exit 1
}

# ì„±ê³µ ë©”ì‹œì§€ ì¶œë ¥ í•¨ìˆ˜
success() {
    echo -e "${GREEN}âœ“ $1${NC}"
}

# 1. Ruff ë¦°íŠ¸ ì²´í¬
echo "ğŸ“ Running ruff lint..."
if ruff check src tests; then
    success "Ruff lint passed"
else
    fail "Ruff lint check"
fi

echo ""

# 2. Mypy íƒ€ì… ì²´í¬
echo "ğŸ”¬ Running mypy type check..."
if mypy src; then
    success "Mypy type check passed"
else
    fail "Mypy type check"
fi

echo ""

# 3. Pytest í…ŒìŠ¤íŠ¸
echo "ğŸ§ª Running pytest..."
if pytest --tb=short -q; then
    success "All tests passed"
else
    fail "Pytest"
fi

echo ""
echo -e "${GREEN}âœ… All pre-push checks passed!${NC}"
echo ""
